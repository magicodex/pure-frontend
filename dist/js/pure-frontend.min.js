"use strict";!function(e,r){function u(){}function l(){}function n(e){this._value=0<arguments.length?e:1}function t(){}function o(){}function a(e,r){if(l.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');if(l.isNullOrUndefined(r))throw new Error('argument#1 "viewInfo is null/undefined');this._viewElement=e,this._viewInfo=r,this._uiNameAttributeName=u.config.uiNameAttributeName,this._dataModel=new uiData.Model(e);e=r.getFullUrl(),r=r.getUrlPattern();this._urlParams=t.parseAllParams(e,r)}function i(){this._viewName=null,this._fullUrl=null,this._urlPattern=null}function s(e,r){if(l.isNullOrUndefined(e))throw new Error('argument#0 "url" is null/undefined');if(l.isNullOrUndefined(r))throw new Error('argument#1 "jqXHR" is null/undefined');this._url=e,this._jqXHR=r}function f(e,r){if(l.isNullOrUndefined(e))throw new Error('argument#0 "targetElement is null/undefined');this._targetElement=e,this._callbackFn=r}function d(){}function w(e){if(l.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');this._viewElement=e}function c(e,r){if(l.isNullOrUndefined(e))throw new Error('argument#0 "deferred" is null/undefined');this._deferred=e,this._sourceElement=r}function m(e){this._sourceElement=e}function g(){}function p(){}function h(){}null==e[r]&&(u.config={uiNameAttributeName:"data-pure-ui-name",viewStatusAttributeName:"data-pure-view-status",viewIndexAttributeName:"data-pure-view-index",tabIndexAttributeName:"data-pure-tab-index",singlePageBaseUrl:"/"},u.messages={unknownError:"UnKnown error",notFoundviewName:"Not found viewName from response header",notFoundFullUrl:"Not found fullUrl from response header",notFoundUrlPattern:"Not found urlPattern from response header"},l.isString=function(e){return"string"==typeof e},l.isNumber=function(e){return"number"==typeof e},l.isObject=function(e){return"object"==typeof e},l.isFunction=function(e){return"function"==typeof e},l.isNullOrUndefined=function(e){return null==e},l.isNotEmptyString=function(e){return l.isString(e)&&0<e.length},l.isNotEmptyObject=function(e){if(!l.isNullOrUndefined(e)&&l.isObject(e))for(var r in e)return!0;return!1},l.emptyStringIfNullOrUndefined=function(e){return l.isNullOrUndefined(e)?"":e},l.emptyArrayIfNullOrUndefined=function(e){return l.isNullOrUndefined(e)?[]:e},l.emptyObjectIfNullOrUndefined=function(e){return l.isNullOrUndefined(e)?{}:e},l.convertToString=function(e){return"string"==typeof e||l.isNullOrUndefined(e)?e:String(e)},l.formatString=function(e,n){if(l.isNullOrUndefined(e))throw new Error('argument#0 "format" is null/undefined');if(!l.isString(e))throw new Error('argument#0 "format" required string');if(!(n instanceof Array)){n=[];for(var r=1;r<arguments.length;r++)n.push(arguments[r])}return e.replace(/\{([0-9]+)\}/g,function(e,r){r=parseInt(r),r=n[r];return l.convertToString(r)||""})},l.concatObjects=function(e){e instanceof Array||(e=arguments);for(var r={},n=0;n<e.length;n++){var t,i=e[n];for(t in i)r[t]=i[t]}return r},n.prototype.nextValue=function(){var e=this._value;return this._value++,e},t.parseAllParams=function(e,r){if(l.isNullOrUndefined(e))throw new Error('argument#0 "fullUrl" is null/undefined');if(l.isNullOrUndefined(r))throw new Error('argument#1 "urlPattern" is null/undefined');r=t.parsePathParams(e,r),e=t.parseQueryParams(e);return l.concatObjects(r,e)},t.parsePathParams=function(e,r){if(l.isNullOrUndefined(e))throw new Error('argument#0 "fullUrl" is null/undefined');if(l.isNullOrUndefined(r))throw new Error('argument#1 "urlPattern" is null/undefined');var n=e.indexOf("?");if(0===n)return{};for(var t={},i=(0<n?e.substring(0,n):e).split("/"),u=r.split("/"),o=0;o<u.length;o++){var a,s=u[o];s.startsWith("{")&&s.endsWith("}")&&(a=s.length-1,s=(s=s.substring(1,a)).trim(),a=l.emptyStringIfNullOrUndefined(i[o]),t[s]=a)}return t},t.parseQueryParams=function(e){if(l.isNullOrUndefined(e))throw new Error('argument#0 "fullUrl" is null/undefined');var r=e.indexOf("?");if(r<0||r+1===e.length)return{};for(var n={},t=e.substring(r+1).split("&"),i=0;i<t.length;i++){var u=t[i].split("="),o=(o=u[0]).trim(),u=(u=l.emptyStringIfNullOrUndefined(u[1])).trim();n[o]=decodeURIComponent(u)}return n},o.getBrowserUrl=function(e){if(l.isString(e))return e=e.startsWith("/")?"#"+e:"#/"+e,o.getFullUrl(u.config.singlePageBaseUrl)+e;throw new Error('argument#0 "viewUrl" required string')},o.setBrowserUrl=function(e){if(!l.isString(e))throw new Error('argument#0 "viewUrl" required string');e=o.getBrowserUrl(e);o.setLocationUrl(e)},o.getFullUrl=function(e){var r;if(l.isString(e))return r=jQuery("base").attr("href"),l.isNullOrUndefined(r)?r="/":r.endsWith("/")||(r+="/"),r+(e=e.startsWith("/")?e.substring(1):e);throw new Error('argument#0 "relativeUrl" required string')},o.setLocationUrl=function(e){if(!l.isString(e))throw new Error('argument#0 "newUrl" required string');location.href=e},a.prototype.getViewElement=function(){return this._viewElement},a.prototype.getViewInfo=function(){return this._viewInfo},a.prototype.getDataModel=function(){return this._dataModel},a.prototype.getUrlParams=function(){return this._urlParams},a.prototype.getUrlParam=function(e){return this._urlParams[e]},a.prototype.callService=function(e,r,n){return new m(this._viewElement).callService(e,r,n)},a.prototype.$find=function(){var e=jQuery(this._viewElement);return e.find.apply(e,arguments)},a.prototype.$ui=function(e){if(l.isNullOrUndefined(e))throw new Error('argument#0 "name" is null/undefined');var r=jQuery(this._viewElement),e=l.formatString('[{0}="{1}"]',[this._uiNameAttributeName,e]);return r.find(e)},i.prototype.getViewName=function(){return this._viewName},i.prototype.setViewName=function(e){this._viewName=e},i.prototype.getFullUrl=function(){return this._fullUrl},i.prototype.setFullUrl=function(e){this._fullUrl=e},i.prototype.getUrlPattern=function(){return this._urlPattern},i.prototype.setUrlPattern=function(e){this._urlPattern=e},s.viewNameHeaderName="x-page-code",s.fullUrlHeaderName="x-page-url",s.urlPatternHeaderName="x-url-pattern",s.prototype.getViewInfo=function(){var e=this._jqXHR.getResponseHeader(s.viewNameHeaderName);if(l.isNullOrUndefined(e))throw new Error(u.messages.notFoundviewName);var r=this._jqXHR.getResponseHeader(s.fullUrlHeaderName);if(l.isNullOrUndefined(r))throw new Error(u.messages.notFoundFullUrl);var n=this._jqXHR.getResponseHeader(s.urlPatternHeaderName);if(l.isNullOrUndefined(n))throw new Error(u.messages.notFoundUrlPattern);var t=new i;return t.setViewName(e),t.setFullUrl(r),t.setUrlPattern(n),t},f.sequenceGenerator=new n(100001),f.lastViewInfo={},f.prototype.loadView=function(t){if(!l.isString(t))throw new Error('argument#0 "url" required string');var e=jQuery.ajax({url:t,type:"POST"}),i=this;e.done(function(e,r,n){i.preRenderView(t,e,r,n)&&i.renderView(t,e,r,n)})},f.prototype.preRenderView=function(e,r,n,t){return!0},f.prototype.renderView=function(e,r,n,t){if(!l.isString(e))throw new Error('argument#0 "url" required string');var t=new s(e,t).getViewInfo(),i=t.getViewName(),u=jQuery(this._targetElement),u=(u.attr("id",i),u.html(r),this.initViewAfterRender(),o.setBrowserUrl(e),new a(this._targetElement,t)),r=d.getViewScope(i);f.lastViewInfo.viewScope=l.emptyObjectIfNullOrUndefined(r),f.lastViewInfo.view=u,l.isNullOrUndefined(r)||(e=r.main,l.isNullOrUndefined(e))||e(r,u),this._callbackFn(r,u)},f.prototype.initViewAfterRender=function(){var i=jQuery(this._targetElement);i.find("label[for]").each(function(e,r){var n,t=r.getAttribute("for");l.isNotEmptyString(t)&&(n=t+"_"+f.sequenceGenerator.nextValue(),i.find("#"+t).attr("id",n),r.setAttribute("for",n))})},d.viewScopes={},d.currentTab={tabIndex:"default"},d.sequenceGenerator=new n(100001),d.appSelector=".pure-app",d.getViewScope=function(e,r){if(!l.isString(e))throw new Error('argument#0 "viewName" required string');r=!(!1===r);var n=d.viewScopes[e];return l.isNullOrUndefined(n)&&r&&(d.viewScopes[e]=n={}),n},d.setViewScope=function(e,r){if(!l.isString(e))throw new Error('argument#0 "viewName" required string');d.viewScopes[e]=r},d.removeViewScope=function(e){if(!l.isString(e))throw new Error('argument#0 "viewName" required string');delete d.viewScopes[e]},d.loadView=function(e){if(!l.isString(e))throw new Error('argument#0 "url" required string');var r=jQuery(d.appSelector),n=l.formatString('main[{0}="{1}"]',[u.config.tabIndexAttributeName,d.currentTab.tabIndex]);r.children(n).each(function(e,r){d.destroyView(r)}),d.doRenderView(e)},d.pushView=function(e){if(!l.isString(e))throw new Error('argument#0 "url" required string');var r=jQuery(d.appSelector),n=l.formatString('main[{0}="{1}"]:first',[u.config.viewStatusAttributeName,"show"]),r=r.children(n);0<r.length&&d.pauseView(r[0]),d.doRenderView(e)},d.popView=function(e){if(!l.isString(e))throw new Error('argument#0 "url" required string');var r=jQuery(d.appSelector),n=l.formatString('main[{0}="{1}"]',[u.config.tabIndexAttributeName,d.currentTab.tabIndex]),r=r.children(n);1<=r.length&&d.destroyView(r[0]),2<=r.length?d.resumeView(r[1]):d.doRenderView(e)},d.doRenderView=function(e){if(!l.isString(e))throw new Error('argument#0 "url" required string');var r=jQuery(d.appSelector),t=jQuery('<main class="pure-view"></main>');t.attr(u.config.viewStatusAttributeName,"loading"),t.attr(u.config.tabIndexAttributeName,d.currentTab.tabIndex),t.css("visibility","hidden"),t.prependTo(r),new f(t[0],function(e,r){var n=d.sequenceGenerator.nextValue(),r=r.getViewInfo().getViewName(),n=r+"_"+n;l.isNullOrUndefined(e)||(d.setViewScope(n,e),d.removeViewScope(r)),t.attr(u.config.viewIndexAttributeName,n),d.initView(t[0])}).loadView(e)},d.initView=function(e){if(l.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');var e=jQuery(e),r=e.attr(u.config.viewIndexAttributeName);e.attr(u.config.viewStatusAttributeName,"show"),e.css("visibility","visible"),l.isNotEmptyString(r)&&(e=d.getViewScope(r,!1),l.isNullOrUndefined(e)||(r=e.onViewCreate,l.isNullOrUndefined(r))||r())},d.destroyView=function(e){if(l.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');var r,e=jQuery(e),n=e.attr(u.config.viewIndexAttributeName);l.isNotEmptyString(n)&&(r=d.getViewScope(n,!1),l.isNullOrUndefined(r)||(r=r.onViewDestroy,l.isNullOrUndefined(r)||r(),d.removeViewScope(n))),e.remove()},d.pauseView=function(e){if(l.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');var e=jQuery(e),r=e.attr(u.config.viewIndexAttributeName);l.isNotEmptyString(r)&&(r=d.getViewScope(r,!1),l.isNullOrUndefined(r)||(r=r.onViewPause,l.isNullOrUndefined(r))||r()),e.attr(u.config.viewStatusAttributeName,"hidden"),e.css("visibility","hidden")},d.resumeView=function(e){if(l.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');var e=jQuery(e),r=e.attr(u.config.viewIndexAttributeName);e.attr(u.config.viewStatusAttributeName,"show"),e.css("visibility","visible"),l.isNotEmptyString(r)&&(e=d.getViewScope(r,!1),l.isNullOrUndefined(e)||(r=e.onViewResume,l.isNullOrUndefined(r))||r())},w.prototype.showMask=function(){jQuery(this._viewElement).prepend('<div class="pure-view-mask"><div></div></div>')},w.prototype.hiddenMask=function(){jQuery(this._viewElement).find(".pure-view-mask").remove()},c.prototype.thenResult=function(e,r){return this.doHandleResult(e,r,!1)},c.prototype.waitResult=function(e,r){return this.doHandleResult(e,r,!0)},c.prototype.doHandleResult=function(e,r,n){if(!l.isFunction(e))throw new Error('argument#1 "doneFn" required function');l.isNullOrUndefined(r)&&(r=function(e,r,n){c.handleAjaxError(this._sourceElement,e,r,n)});var t,i=this._deferred;return n&&!l.isNullOrUndefined(this._sourceElement)&&((t=new w(this._sourceElement)).showMask(),i.always(function(){t.hiddenMask()})),!1===jQuery.ajaxSettings.async?(200===i.status?e(i.responseJSON||responseText,"success",i):"timeout"===i.statusText?r(i,"timeout","timeout"):r(i,"error",""),i):i.then(e,r)},c.handleAjaxError=function(e,r,n,t){if(l.isNullOrUndefined(r))throw new Error('argument#0 "jqXHR" is null/undefined');var i;l.isNullOrUndefined(r.responseJSON)||(i=r.responseJSON.message),h.showError(i||u.message.unknownError)},m.prototype.callService=function(e,r,n){if(!l.isString(e))throw new Error('argument#0 "url" required string');r=l.emptyObjectIfNullOrUndefined(r),n=l.emptyObjectIfNullOrUndefined(n);e={url:e,type:"POST",cache:!1,contentType:"application/json",dataType:"json",data:JSON.stringify(r),beforeSend:this.beforeSend,error:function(e,r,n){}},r=l.concatObjects([e,n]);return new c(jQuery.ajax(r),this._sourceElement)},m.prototype.beforeSend=function(e,r){},g.callService=function(e,r,n){if(l.isString(e))return(new m).callService(e,r,n);throw new Error('argument#0 "url" required string')},p.showMessage=function(e){e=l.emptyStringIfNullOrUndefined(e);var e=l.formatString('<div class="alert alert-success pure-app-alert" role="alert">{0}</div>',[e]),r=jQuery(e).prependTo("body");r.delay(1e3).fadeOut("fast",function(){r.remove()})},p.showError=function(e){e=l.emptyStringIfNullOrUndefined(e);var e=l.formatString('<div class="alert alert-warning pure-app-alert" role="alert">{0}</div>',[e]),r=jQuery(e).prependTo("body");r.delay(2e3).fadeOut("fast",function(){r.remove()})},h.viewScope=function(e,r){if(!l.isString(e))throw new Error('argument#0 "viewName" required string');if(!l.isFunction(r))throw new Error('argument#1 "callbackFn" required function');r(d.getViewScope(e))},h.viewMain=function(e,r){if(!l.isString(e))throw new Error('argument#0 "viewName" required string');if(!l.isFunction(r))throw new Error('argument#1 "mainFn" required function');d.getViewScope(e).main=r},h.showMessage=function(e){p.showError(e)},h.showError=function(e){p.showError(e)},h.loadView=function(e){d.loadView(e)},h.pushView=function(e){d.pushView(e)},h.popView=function(e){d.popView(e)},e[r]={utils:l,app:h,config:u.config,messages:u.messages,fn:{Global:u,Utils:l,SequenceGenerator:n,UrlParser:t,BrowserUrl:o,View:a,ViewInfo:i,ViewResponse:s,ViewLoader:f,ViewManager:d,ViewMask:w,AjaxResult:c,AjaxCallService:m,Ajax:g,AppAlertMessages:p,App:h}})}(window,"Pure");