"use strict";!function(e,t){function a(){}function s(){}function r(e){this._value=0<arguments.length?e:1}function n(){}function i(){}function o(){}function l(e,t,r){if(s.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');if(s.isNullOrUndefined(t))throw new Error('argument#1 "viewInfo is null/undefined');this._viewElement=e,this._viewInfo=t,this._viewScope=r,this._uiNameAttributeName=a.config.uiNameAttributeName,this._dataModel=new uiData.Model(e);r=t.getFullUrl(),e=t.getUrlPattern();this._urlParams=n.parseAllParams(r,e)}function u(){this._viewName=null,this._viewTitle=null,this._fullUrl=null,this._urlPattern=null}function f(e,t){if(s.isNullOrUndefined(e))throw new Error('argument#0 "url" is null/undefined');if(s.isNullOrUndefined(t))throw new Error('argument#1 "jqXHR" is null/undefined');this._url=e,this._jqXHR=t}function d(e,t){if(s.isNullOrUndefined(e))throw new Error('argument#0 "targetElement is null/undefined');this._targetElement=e,this._callbackFn=t}function c(){}function w(e){return e.length<=0||(e=e.attr(a.config.viewIndexAttributeName),!s.isNotEmptyString(e))||(e=c.getViewScope(e,!1),s.isNullOrUndefined(e))||(e=e.onViewClosing,s.isNullOrUndefined(e))?null:e}function g(e){if(s.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');this._viewElement=e}function p(e,t){if(s.isNullOrUndefined(e))throw new Error('argument#0 "deferred" is null/undefined');this._deferred=e,this._sourceElement=t}function m(e){this._sourceElement=e}function h(){}function N(){}function S(){}null==e[t]&&(a.config={viewStatusAttributeName:"data-pure-view-status",viewIndexAttributeName:"data-pure-view-index",viewUrlAttributeName:"data-pure-view-url",viewTitleAttributeName:"data-pure-view-title",tabIndexAttributeName:"data-pure-tab-index",uiNameAttributeName:"data-pure-ui-name",singlePageBaseUrl:"/"},a.messages={unknownError:"Unknown error!",notFoundviewName:"Not found viewName from response header!",notFoundFullUrl:"Not found fullUrl from response header!",notFoundUrlPattern:"Not found urlPattern from response header!"},s.isString=function(e){return"string"==typeof e},s.isNumber=function(e){return"number"==typeof e},s.isObject=function(e){return"object"==typeof e},s.isFunction=function(e){return"function"==typeof e},s.isNullOrUndefined=function(e){return null==e},s.isNotEmptyString=function(e){return s.isString(e)&&0<e.length},s.isNotEmptyObject=function(e){if(!s.isNullOrUndefined(e)&&s.isObject(e))for(var t in e)return!0;return!1},s.emptyStringIfNullOrUndefined=function(e){return s.isNullOrUndefined(e)?"":e},s.emptyArrayIfNullOrUndefined=function(e){return s.isNullOrUndefined(e)?[]:e},s.emptyObjectIfNullOrUndefined=function(e){return s.isNullOrUndefined(e)?{}:e},s.convertToString=function(e){return"string"==typeof e||s.isNullOrUndefined(e)?e:String(e)},s.formatString=function(e,r){if(s.isNullOrUndefined(e))throw new Error('argument#0 "format" is null/undefined');if(!s.isString(e))throw new Error('argument#0 "format" required string');if(!(r instanceof Array)){r=[];for(var t=1;t<arguments.length;t++)r.push(arguments[t])}return e.replace(/\{([0-9]+)\}/g,function(e,t){t=parseInt(t),t=r[t];return s.convertToString(t)||""})},s.concatObjects=function(e){e instanceof Array||(e=arguments);for(var t={},r=0;r<e.length;r++){var n,i=e[r];for(n in i)t[n]=i[n]}return t},r.prototype.nextValue=function(){var e=this._value;return this._value++,e},n.parseAllParams=function(e,t){if(s.isNullOrUndefined(e))throw new Error('argument#0 "fullUrl" is null/undefined');if(s.isNullOrUndefined(t))throw new Error('argument#1 "urlPattern" is null/undefined');t=n.parsePathParams(e,t),e=n.parseQueryParams(e);return s.concatObjects(t,e)},n.parsePathParams=function(e,t){if(s.isNullOrUndefined(e))throw new Error('argument#0 "fullUrl" is null/undefined');if(s.isNullOrUndefined(t))throw new Error('argument#1 "urlPattern" is null/undefined');var r=e.indexOf("?");if(0===r)return{};for(var n={},i=(0<r?e.substring(0,r):e).split("/"),o=t.split("/"),u=0;u<o.length;u++){var a,l=o[u];l.startsWith("{")&&l.endsWith("}")&&(a=l.length-1,l=(l=l.substring(1,a)).trim(),a=s.emptyStringIfNullOrUndefined(i[u]),n[l]=a)}return n},n.parseQueryParams=function(e){if(s.isNullOrUndefined(e))throw new Error('argument#0 "fullUrl" is null/undefined');var t=e.indexOf("?");if(t<0||t+1===e.length)return{};for(var r={},n=e.substring(t+1).split("&"),i=0;i<n.length;i++){var o=n[i].split("="),u=(u=o[0]).trim(),o=(o=s.emptyStringIfNullOrUndefined(o[1])).trim();r[u]=decodeURIComponent(o)}return r},i.getBrowserUrl=function(e){if(s.isString(e))return e=e.startsWith("/")?"#"+e:"#/"+e,i.getFullUrl(a.config.singlePageBaseUrl)+e;throw new Error('argument#0 "viewUrl" required string')},i.setBrowserUrl=function(e){if(!s.isString(e))throw new Error('argument#0 "viewUrl" required string');e=i.getBrowserUrl(e);i.setLocationUrl(e)},i.getFullUrl=function(e){var t;if(s.isString(e))return t=jQuery("base").attr("href"),s.isNullOrUndefined(t)?t="/":t.endsWith("/")||(t+="/"),t+(e=e.startsWith("/")?e.substring(1):e);throw new Error('argument#0 "relativeUrl" required string')},i.setLocationUrl=function(e){if(!s.isString(e))throw new Error('argument#0 "newUrl" required string');location.href=e},o.setBrowserTitle=function(e){},l.prototype.getViewElement=function(){return this._viewElement},l.prototype.getViewInfo=function(){return this._viewInfo},l.prototype.getViewScope=function(){return this._viewScope},l.prototype.getDataModel=function(){return this._dataModel},l.prototype.getUrlParams=function(){return this._urlParams},l.prototype.getUrlParam=function(e){return this._urlParams[e]},l.prototype.callService=function(e,t,r){return new m(this._viewElement).callService(e,t,r)},l.prototype.$find=function(){var e=jQuery(this._viewElement);return e.find.apply(e,arguments)},l.prototype.$ui=function(e){if(s.isNullOrUndefined(e))throw new Error('argument#0 "name" is null/undefined');var t=jQuery(this._viewElement),e=s.formatString('[{0}="{1}"]',[this._uiNameAttributeName,e]);return t.find(e)},u.prototype.getViewName=function(){return this._viewName},u.prototype.setViewName=function(e){this._viewName=e},u.prototype.getViewTitle=function(){return this._viewTitle},u.prototype.setViewTitle=function(e){this._viewTitle=e},u.prototype.getFullUrl=function(){return this._fullUrl},u.prototype.setFullUrl=function(e){this._fullUrl=e},u.prototype.getUrlPattern=function(){return this._urlPattern},u.prototype.setUrlPattern=function(e){this._urlPattern=e},f.viewNameHeaderName="x-page-code",f.viewTitleHeaderName="x-page-name",f.fullUrlHeaderName="x-page-url",f.urlPatternHeaderName="x-url-pattern",f.prototype.getViewInfo=function(){var e=this._jqXHR.getResponseHeader(f.viewNameHeaderName);if(s.isNullOrUndefined(e))throw new Error(a.messages.notFoundviewName);var t=this._jqXHR.getResponseHeader(f.fullUrlHeaderName);if(s.isNullOrUndefined(t))throw new Error(a.messages.notFoundFullUrl);var r=this._jqXHR.getResponseHeader(f.urlPatternHeaderName);if(s.isNullOrUndefined(r))throw new Error(a.messages.notFoundUrlPattern);var n=this._jqXHR.getResponseHeader(f.viewTitleHeaderName),i=(s.isNotEmptyString(n)&&(n=decodeURIComponent(n)),new u);return i.setViewName(e),i.setViewTitle(n),i.setFullUrl(t),i.setUrlPattern(r),i},d.sequenceGenerator=new r(100001),d.lastViewInfo={},d.prototype.loadView=function(n){if(!s.isString(n))throw new Error('argument#0 "url" required string');var e=jQuery.ajax({url:n,type:"POST",error:function(e,t,r){}}),i=this;e.done(function(e,t,r){try{i.preRenderView(n,e,t,r)?i.renderView(n,e,t,r):i._callbackFn(!1)}catch(e){console.error(e.message),i._callbackFn(!1)}}).fail(function(e,t,r){p.handleAjaxError(null,e,t,r),i._callbackFn(!1)})},d.prototype.preRenderView=function(e,t,r,n){return!0},d.prototype.renderView=function(e,t,r,n){if(!s.isString(e))throw new Error('argument#0 "url" required string');var n=new f(e,n).getViewInfo(),i=n.getViewName(),o=n.getViewTitle(),u=jQuery(this._targetElement),t=(u.attr("id",i),u.html(t),u.attr(a.config.viewUrlAttributeName,e),u.attr(a.config.viewTitleAttributeName,o),this.initViewAfterRender(),c.getViewScope(i)),e=new l(this._targetElement,n,t);d.lastViewInfo.viewScope=s.emptyObjectIfNullOrUndefined(t),d.lastViewInfo.view=e,s.isNullOrUndefined(t)||(u=t.main,s.isNullOrUndefined(u))||u(t,e),s.isNullOrUndefined(this._callbackFn)||this._callbackFn(!0,t,e)},d.prototype.initViewAfterRender=function(){var i=jQuery(this._targetElement);i.find("label[for]").each(function(e,t){var r,n=t.getAttribute("for");s.isNotEmptyString(n)&&(r=n+"_"+d.sequenceGenerator.nextValue(),i.find("#"+n).attr("id",r),t.setAttribute("for",r))})},c.privateFn={getOnViewClosingFn:w},c.viewScopes={},c.currentTab={tabIndex:"default"},c.sequenceGenerator=new r(100001),c.appSelector=".pure-app",c.VIEW_STATUS_LOADING="loading",c.VIEW_STATUS_SHOW="show",c.VIEW_STATUS_HIDDEN="hidden",c.VIEW_STATUS_DESTROY="destroy",c.getViewScope=function(e,t){if(!s.isString(e))throw new Error('argument#0 "viewName" required string');t=!(!1===t);var r=c.viewScopes[e];return s.isNullOrUndefined(r)&&t&&(c.viewScopes[e]=r={}),r},c.setViewScope=function(e,t){if(!s.isString(e))throw new Error('argument#0 "viewName" required string');c.viewScopes[e]=t},c.removeViewScope=function(e){if(!s.isString(e))throw new Error('argument#0 "viewName" required string');delete c.viewScopes[e]},c.loadView=function(e){if(!s.isString(e))throw new Error('argument#0 "url" required string');function t(){c.doRenderView(e,function(){i.each(function(e,t){c.stopViewLifecycle(t)})})}var r=jQuery(c.appSelector),n=s.formatString('main[{0}="{1}"]',[a.config.tabIndexAttributeName,c.currentTab.tabIndex]),i=r.children(n),r=w(i);s.isNullOrUndefined(r)?t():r(t)},c.replaceView=function(e){if(!s.isString(e))throw new Error('argument#0 "url" required string');var t=jQuery(c.appSelector),r=s.formatString('main[{0}="{1}"]',[a.config.tabIndexAttributeName,c.currentTab.tabIndex]),n=t.children(r);c.doRenderView(e,function(){c.stopViewLifecycle(n[0])})},c.pushView=function(e){if(!s.isString(e))throw new Error('argument#0 "url" required string');var t=jQuery(c.appSelector),r=s.formatString('main[{0}="{1}"]:first',[a.config.viewStatusAttributeName,c.VIEW_STATUS_SHOW]),n=t.children(r);c.doRenderView(e,function(){0<n.length&&c.hiddenView(n[0],!0)})},c.popView=function(e){if(!s.isString(e))throw new Error('argument#0 "url" required string');function t(){2<=i.length?(c.stopViewLifecycle(i[0]),c.showView(i[1],!0)):c.doRenderView(e,function(){1<=i.length&&c.stopViewLifecycle(i[0])})}var r=jQuery(c.appSelector),n=s.formatString('main[{0}="{1}"]',[a.config.tabIndexAttributeName,c.currentTab.tabIndex]),i=r.children(n),r=w(i);s.isNullOrUndefined(r)?t():r(t)},c.doRenderView=function(e,n){if(!s.isString(e))throw new Error('argument#0 "url" required string');var i,t=jQuery(c.appSelector),r=s.formatString('main[{0}="{1}"][{2}="{3}"]',[a.config.tabIndexAttributeName,c.currentTab.tabIndex,a.config.viewStatusAttributeName,c.VIEW_STATUS_LOADING]);0<t.find(r).length||((i=jQuery('<main class="pure-view"></main>')).attr(a.config.viewStatusAttributeName,c.VIEW_STATUS_LOADING),i.attr(a.config.tabIndexAttributeName,c.currentTab.tabIndex),i.css("display","none"),i.prependTo(t),new d(i[0],function(e,t,r){!0!==e?c.stopViewLifecycle(i):(e=c.sequenceGenerator.nextValue(),r=r.getViewInfo().getViewName(),i.attr(a.config.viewIndexAttributeName,e=r+"_"+e),s.isNullOrUndefined(t)||(c.setViewScope(e,t),c.removeViewScope(r)),s.isNullOrUndefined(n)||n(),c.startViewLifecycle(i[0]))}).loadView(e))},c.startViewLifecycle=function(e){if(s.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');var t=jQuery(e),r=t.attr(a.config.viewIndexAttributeName),n=t.attr(a.config.tabIndexAttributeName);t.attr(a.config.viewStatusAttributeName)===c.VIEW_STATUS_DESTROY?c.removeViewScope(r):(s.isNotEmptyString(r)&&(t=c.getViewScope(r,!1),s.isNullOrUndefined(t)||(r=t.onViewLifecycleStart,s.isNullOrUndefined(r))||r()),n===c.currentTab.tabIndex?c.showView(e):c.hiddenView(e))},c.stopViewLifecycle=function(e){if(s.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');c.hiddenView(e);var t,e=jQuery(e),r=e.attr(a.config.viewIndexAttributeName),n=e.attr(a.config.viewStatusAttributeName);n!==c.VIEW_STATUS_HIDDEN&&n!==c.VIEW_STATUS_LOADING||(s.isNotEmptyString(r)&&(t=c.getViewScope(r,!1),n===c.VIEW_STATUS_LOADING||s.isNullOrUndefined(t)||(n=t.onViewLifecycleStop,s.isNullOrUndefined(n)||n(),c.removeViewScope(r))),e.attr(a.config.viewStatusAttributeName,c.VIEW_STATUS_DESTROY),e.remove())},c.showView=function(e,t){if(s.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');t=!0===t;var e=jQuery(e),r=e.attr(a.config.viewIndexAttributeName),n=e.attr(a.config.viewStatusAttributeName);n!==c.VIEW_STATUS_LOADING&&n!==c.VIEW_STATUS_HIDDEN||(e.attr(a.config.viewStatusAttributeName,c.VIEW_STATUS_SHOW),e.css("display","block"),n=e.attr(a.config.viewUrlAttributeName),i.setBrowserUrl(n),n=e.attr(a.config.viewTitleAttributeName),o.setBrowserTitle(n),s.isNotEmptyString(r)&&(e=c.getViewScope(r,!1),s.isNullOrUndefined(e)||(n=e.onViewShow,s.isNullOrUndefined(n)||n(),t&&(r=e.onViewPop,s.isNullOrUndefined(r)||r()))))},c.hiddenView=function(e,t){if(s.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');t=!0===t;var e=jQuery(e),r=e.attr(a.config.viewIndexAttributeName),n=e.attr(a.config.viewStatusAttributeName);n!==c.VIEW_STATUS_SHOW&&n!==c.VIEW_STATUS_LOADING||(s.isNotEmptyString(r)&&(r=c.getViewScope(r,!1),n===c.VIEW_STATUS_LOADING||s.isNullOrUndefined(r)||(n=r.onViewHidden,s.isNullOrUndefined(n)||n(),t&&(n=r.onViewPush,s.isNullOrUndefined(n)||n()))),e.attr(a.config.viewStatusAttributeName,c.VIEW_STATUS_HIDDEN),e.css("display","none"))},g.prototype.showMask=function(){jQuery(this._viewElement).prepend('<div class="pure-view-mask"><div></div></div>')},g.prototype.hiddenMask=function(){jQuery(this._viewElement).find(".pure-view-mask").remove()},p.prototype.thenResult=function(e,t){return this.doHandleResult(e,t,!1)},p.prototype.waitResult=function(e,t){return this.doHandleResult(e,t,!0)},p.prototype.doHandleResult=function(e,t,r){if(!s.isFunction(e))throw new Error('argument#1 "doneFn" required function');s.isNullOrUndefined(t)&&(t=function(e,t,r){p.handleAjaxError(this._sourceElement,e,t,r)});var n,i=this._deferred;return r&&!s.isNullOrUndefined(this._sourceElement)&&((n=new g(this._sourceElement)).showMask(),i.always(function(){n.hiddenMask()})),!1===jQuery.ajaxSettings.async?(200===i.status?e(i.responseJSON||responseText,"success",i):"timeout"===i.statusText?t(i,"timeout","timeout"):t(i,"error",""),i):i.then(e,t)},p.handleAjaxError=function(e,t,r,n){if(s.isNullOrUndefined(t))throw new Error('argument#0 "jqXHR" is null/undefined');var i;s.isNullOrUndefined(t.responseJSON)||(i=t.responseJSON.message),S.showError(i||a.messages.unknownError)},m.prototype.callService=function(e,t,r){if(!s.isString(e))throw new Error('argument#0 "url" required string');r=s.emptyObjectIfNullOrUndefined(r);e={url:e,type:"POST",cache:!1,contentType:"application/json",dataType:"json",data:t=this.convertData(t,r),beforeSend:this.beforeSend,error:function(e,t,r){}},t=s.concatObjects([e,r]);return new p(jQuery.ajax(t),this._sourceElement)},m.prototype.beforeSend=function(e,t){},m.prototype.convertData=function(e,t){return e=s.emptyObjectIfNullOrUndefined(e),JSON.stringify(e)},h.callService=function(e,t,r){if(s.isString(e))return(new m).callService(e,t,r);throw new Error('argument#0 "url" required string')},N.showMessage=function(e){e=s.emptyStringIfNullOrUndefined(e);var e=s.formatString('<div class="alert alert-success pure-app-alert" role="alert">{0}</div>',[e]),t=jQuery(e).prependTo("body");t.delay(1e3).fadeOut("fast",function(){t.remove()})},N.showError=function(e){e=s.emptyStringIfNullOrUndefined(e);var e=s.formatString('<div class="alert alert-warning pure-app-alert" role="alert">{0}</div>',[e]),t=jQuery(e).prependTo("body");t.delay(2e3).fadeOut("fast",function(){t.remove()})},S.viewScope=function(e,t){if(!s.isString(e))throw new Error('argument#0 "viewName" required string');if(!s.isFunction(t))throw new Error('argument#1 "registerFn" required function');t(c.getViewScope(e))},S.viewMain=function(e,t){if(!s.isString(e))throw new Error('argument#0 "viewName" required string');if(!s.isFunction(t))throw new Error('argument#1 "mainFn" required function');c.getViewScope(e).main=t},S.showMessage=function(e){N.showMessage(e)},S.showError=function(e){N.showError(e)},S.loadView=function(e){c.loadView(e)},S.replaceView=function(e){c.replaceView(e)},S.pushView=function(e){c.pushView(e)},S.popView=function(e){c.popView(e)},e[t]={utils:s,app:S,config:a.config,messages:a.messages,fn:{Global:a,Utils:s,SequenceGenerator:r,UrlParser:n,BrowserUrl:i,BrowserTitle:o,View:l,ViewInfo:u,ViewResponse:f,ViewLoader:d,ViewManager:c,ViewMask:g,AjaxResult:p,AjaxCallService:m,Ajax:h,AppAlertMessages:N,App:S}})}(window,"Pure");