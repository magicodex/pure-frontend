"use strict";!function(e,r){function o(){}function s(){}function t(e){this._value=0<arguments.length?e:1}function n(){}function u(){}function a(e,r){if(s.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');if(s.isNullOrUndefined(r))throw new Error('argument#1 "viewInfo is null/undefined');this._viewElement=e,this._viewInfo=r,this._uiNameAttributeName=o.config.uiNameAttributeName,this._dataModel=new uiData.Model(e);e=r.getFullUrl(),r=r.getUrlPattern();this._urlParams=n.parseAllParams(e,r)}function i(){this._viewName=null,this._fullUrl=null,this._urlPattern=null}function l(e,r){if(s.isNullOrUndefined(e))throw new Error('argument#0 "url" is null/undefined');if(s.isNullOrUndefined(r))throw new Error('argument#1 "jqXHR" is null/undefined');this._url=e,this._jqXHR=r}function f(e,r){if(s.isNullOrUndefined(e))throw new Error('argument#0 "targetElement is null/undefined');this._targetElement=e,this._callbackFn=r}function d(){}function c(e){if(s.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');this._viewElement=e}function w(e,r){if(s.isNullOrUndefined(e))throw new Error('argument#0 "deferred" is null/undefined');this._deferred=e,this._sourceElement=r}function g(e){this._sourceElement=e}function m(){}function p(){}function h(){}null==e[r]&&(o.config={uiNameAttributeName:"data-pure-ui-name",viewStatusAttributeName:"data-pure-view-status",viewIndexAttributeName:"data-pure-view-index",tabIndexAttributeName:"data-pure-tab-index",singlePageBaseUrl:"/"},o.messages={unknownError:"Unknown error!",notFoundviewName:"Not found viewName from response header!",notFoundFullUrl:"Not found fullUrl from response header!",notFoundUrlPattern:"Not found urlPattern from response header!"},s.isString=function(e){return"string"==typeof e},s.isNumber=function(e){return"number"==typeof e},s.isObject=function(e){return"object"==typeof e},s.isFunction=function(e){return"function"==typeof e},s.isNullOrUndefined=function(e){return null==e},s.isNotEmptyString=function(e){return s.isString(e)&&0<e.length},s.isNotEmptyObject=function(e){if(!s.isNullOrUndefined(e)&&s.isObject(e))for(var r in e)return!0;return!1},s.emptyStringIfNullOrUndefined=function(e){return s.isNullOrUndefined(e)?"":e},s.emptyArrayIfNullOrUndefined=function(e){return s.isNullOrUndefined(e)?[]:e},s.emptyObjectIfNullOrUndefined=function(e){return s.isNullOrUndefined(e)?{}:e},s.convertToString=function(e){return"string"==typeof e||s.isNullOrUndefined(e)?e:String(e)},s.formatString=function(e,t){if(s.isNullOrUndefined(e))throw new Error('argument#0 "format" is null/undefined');if(!s.isString(e))throw new Error('argument#0 "format" required string');if(!(t instanceof Array)){t=[];for(var r=1;r<arguments.length;r++)t.push(arguments[r])}return e.replace(/\{([0-9]+)\}/g,function(e,r){r=parseInt(r),r=t[r];return s.convertToString(r)||""})},s.concatObjects=function(e){e instanceof Array||(e=arguments);for(var r={},t=0;t<e.length;t++){var n,i=e[t];for(n in i)r[n]=i[n]}return r},t.prototype.nextValue=function(){var e=this._value;return this._value++,e},n.parseAllParams=function(e,r){if(s.isNullOrUndefined(e))throw new Error('argument#0 "fullUrl" is null/undefined');if(s.isNullOrUndefined(r))throw new Error('argument#1 "urlPattern" is null/undefined');r=n.parsePathParams(e,r),e=n.parseQueryParams(e);return s.concatObjects(r,e)},n.parsePathParams=function(e,r){if(s.isNullOrUndefined(e))throw new Error('argument#0 "fullUrl" is null/undefined');if(s.isNullOrUndefined(r))throw new Error('argument#1 "urlPattern" is null/undefined');var t=e.indexOf("?");if(0===t)return{};for(var n={},i=(0<t?e.substring(0,t):e).split("/"),o=r.split("/"),u=0;u<o.length;u++){var a,l=o[u];l.startsWith("{")&&l.endsWith("}")&&(a=l.length-1,l=(l=l.substring(1,a)).trim(),a=s.emptyStringIfNullOrUndefined(i[u]),n[l]=a)}return n},n.parseQueryParams=function(e){if(s.isNullOrUndefined(e))throw new Error('argument#0 "fullUrl" is null/undefined');var r=e.indexOf("?");if(r<0||r+1===e.length)return{};for(var t={},n=e.substring(r+1).split("&"),i=0;i<n.length;i++){var o=n[i].split("="),u=(u=o[0]).trim(),o=(o=s.emptyStringIfNullOrUndefined(o[1])).trim();t[u]=decodeURIComponent(o)}return t},u.getBrowserUrl=function(e){if(s.isString(e))return e=e.startsWith("/")?"#"+e:"#/"+e,u.getFullUrl(o.config.singlePageBaseUrl)+e;throw new Error('argument#0 "viewUrl" required string')},u.setBrowserUrl=function(e){if(!s.isString(e))throw new Error('argument#0 "viewUrl" required string');e=u.getBrowserUrl(e);u.setLocationUrl(e)},u.getFullUrl=function(e){var r;if(s.isString(e))return r=jQuery("base").attr("href"),s.isNullOrUndefined(r)?r="/":r.endsWith("/")||(r+="/"),r+(e=e.startsWith("/")?e.substring(1):e);throw new Error('argument#0 "relativeUrl" required string')},u.setLocationUrl=function(e){if(!s.isString(e))throw new Error('argument#0 "newUrl" required string');location.href=e},a.prototype.getViewElement=function(){return this._viewElement},a.prototype.getViewInfo=function(){return this._viewInfo},a.prototype.getDataModel=function(){return this._dataModel},a.prototype.getUrlParams=function(){return this._urlParams},a.prototype.getUrlParam=function(e){return this._urlParams[e]},a.prototype.callService=function(e,r,t){return new g(this._viewElement).callService(e,r,t)},a.prototype.$find=function(){var e=jQuery(this._viewElement);return e.find.apply(e,arguments)},a.prototype.$ui=function(e){if(s.isNullOrUndefined(e))throw new Error('argument#0 "name" is null/undefined');var r=jQuery(this._viewElement),e=s.formatString('[{0}="{1}"]',[this._uiNameAttributeName,e]);return r.find(e)},i.prototype.getViewName=function(){return this._viewName},i.prototype.setViewName=function(e){this._viewName=e},i.prototype.getFullUrl=function(){return this._fullUrl},i.prototype.setFullUrl=function(e){this._fullUrl=e},i.prototype.getUrlPattern=function(){return this._urlPattern},i.prototype.setUrlPattern=function(e){this._urlPattern=e},l.viewNameHeaderName="x-page-code",l.fullUrlHeaderName="x-page-url",l.urlPatternHeaderName="x-url-pattern",l.prototype.getViewInfo=function(){var e=this._jqXHR.getResponseHeader(l.viewNameHeaderName);if(s.isNullOrUndefined(e))throw new Error(o.messages.notFoundviewName);var r=this._jqXHR.getResponseHeader(l.fullUrlHeaderName);if(s.isNullOrUndefined(r))throw new Error(o.messages.notFoundFullUrl);var t=this._jqXHR.getResponseHeader(l.urlPatternHeaderName);if(s.isNullOrUndefined(t))throw new Error(o.messages.notFoundUrlPattern);var n=new i;return n.setViewName(e),n.setFullUrl(r),n.setUrlPattern(t),n},f.sequenceGenerator=new t(100001),f.lastViewInfo={},f.prototype.loadView=function(n){if(!s.isString(n))throw new Error('argument#0 "url" required string');var e=jQuery.ajax({url:n,type:"POST",error:function(e,r,t){}}),i=this;e.done(function(e,r,t){try{i.preRenderView(n,e,r,t)?i.renderView(n,e,r,t):i._callbackFn(!1)}catch(e){console.error(e.message),i._callbackFn(!1)}}).fail(function(e,r,t){w.handleAjaxError(null,e,r,t),i._callbackFn(!1)})},f.prototype.preRenderView=function(e,r,t,n){return!0},f.prototype.renderView=function(e,r,t,n){if(!s.isString(e))throw new Error('argument#0 "url" required string');var n=new l(e,n).getViewInfo(),i=n.getViewName(),o=jQuery(this._targetElement),o=(o.attr("id",i),o.html(r),this.initViewAfterRender(),u.setBrowserUrl(e),new a(this._targetElement,n)),r=d.getViewScope(i);f.lastViewInfo.viewScope=s.emptyObjectIfNullOrUndefined(r),f.lastViewInfo.view=o,s.isNullOrUndefined(r)||(e=r.main,s.isNullOrUndefined(e))||e(r,o),s.isNullOrUndefined(this._callbackFn)||this._callbackFn(!0,r,o)},f.prototype.initViewAfterRender=function(){var i=jQuery(this._targetElement);i.find("label[for]").each(function(e,r){var t,n=r.getAttribute("for");s.isNotEmptyString(n)&&(t=n+"_"+f.sequenceGenerator.nextValue(),i.find("#"+n).attr("id",t),r.setAttribute("for",t))})},d.viewScopes={},d.currentTab={tabIndex:"default"},d.sequenceGenerator=new t(100001),d.appSelector=".pure-app",d.VIEW_STATUS_LOADING="loading",d.VIEW_STATUS_SHOW="show",d.VIEW_STATUS_HIDDEN="hidden",d.VIEW_STATUS_DESTROY="destroy",d.getViewScope=function(e,r){if(!s.isString(e))throw new Error('argument#0 "viewName" required string');r=!(!1===r);var t=d.viewScopes[e];return s.isNullOrUndefined(t)&&r&&(d.viewScopes[e]=t={}),t},d.setViewScope=function(e,r){if(!s.isString(e))throw new Error('argument#0 "viewName" required string');d.viewScopes[e]=r},d.removeViewScope=function(e){if(!s.isString(e))throw new Error('argument#0 "viewName" required string');delete d.viewScopes[e]},d.loadView=function(e){if(!s.isString(e))throw new Error('argument#0 "url" required string');var r=jQuery(d.appSelector),t=s.formatString('main[{0}="{1}"]',[o.config.tabIndexAttributeName,d.currentTab.tabIndex]),n=r.children(t);d.doRenderView(e,function(){n.each(function(e,r){d.stopViewLifecycle(r)})})},d.pushView=function(e){if(!s.isString(e))throw new Error('argument#0 "url" required string');var r=jQuery(d.appSelector),t=s.formatString('main[{0}="{1}"]:first',[o.config.viewStatusAttributeName,d.VIEW_STATUS_SHOW]),n=r.children(t);d.doRenderView(e,function(){0<n.length&&d.hiddenView(n[0])})},d.popView=function(e){if(!s.isString(e))throw new Error('argument#0 "url" required string');var r=jQuery(d.appSelector),t=s.formatString('main[{0}="{1}"]',[o.config.tabIndexAttributeName,d.currentTab.tabIndex]),n=r.children(t);2<=n.length?(d.stopViewLifecycle(n[0]),d.showView(n[1])):d.doRenderView(e,function(){1<=n.length&&d.stopViewLifecycle(n[0])})},d.doRenderView=function(e,n){if(!s.isString(e))throw new Error('argument#0 "url" required string');var i,r=jQuery(d.appSelector),t=s.formatString('main[{0}="{1}"][{2}="{3}"]',[o.config.tabIndexAttributeName,d.currentTab.tabIndex,o.config.viewStatusAttributeName,d.VIEW_STATUS_LOADING]);0<r.find(t).length||((i=jQuery('<main class="pure-view"></main>')).attr(o.config.viewStatusAttributeName,d.VIEW_STATUS_LOADING),i.attr(o.config.tabIndexAttributeName,d.currentTab.tabIndex),i.css("display","none"),i.prependTo(r),new f(i[0],function(e,r,t){!0!==e?d.stopViewLifecycle(i):(e=d.sequenceGenerator.nextValue(),t=t.getViewInfo().getViewName(),i.attr(o.config.viewIndexAttributeName,e=t+"_"+e),s.isNullOrUndefined(r)||(d.setViewScope(e,r),d.removeViewScope(t)),s.isNullOrUndefined(n)||n(),d.startViewLifecycle(i[0]))}).loadView(e))},d.startViewLifecycle=function(e){if(s.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');var r=jQuery(e),t=r.attr(o.config.viewIndexAttributeName),n=r.attr(o.config.tabIndexAttributeName);r.attr(o.config.viewStatusAttributeName)===d.VIEW_STATUS_DESTROY?d.removeViewScope(t):(s.isNotEmptyString(t)&&(r=d.getViewScope(t,!1),s.isNullOrUndefined(r)||(t=r.onViewLifecycleStart,s.isNullOrUndefined(t))||t()),n===d.currentTab.tabIndex?d.showView(e):d.hiddenView(e))},d.stopViewLifecycle=function(e){if(s.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');d.hiddenView(e);var r,e=jQuery(e),t=e.attr(o.config.viewIndexAttributeName),n=e.attr(o.config.viewStatusAttributeName);n!==d.VIEW_STATUS_HIDDEN&&n!==d.VIEW_STATUS_LOADING||(s.isNotEmptyString(t)&&(r=d.getViewScope(t,!1),n===d.VIEW_STATUS_LOADING||s.isNullOrUndefined(r)||(n=r.onViewLifecycleStop,s.isNullOrUndefined(n)||n(),d.removeViewScope(t))),e.attr(o.config.viewStatusAttributeName,d.VIEW_STATUS_DESTROY),e.remove())},d.showView=function(e){if(s.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');var e=jQuery(e),r=e.attr(o.config.viewIndexAttributeName),t=e.attr(o.config.viewStatusAttributeName);t!==d.VIEW_STATUS_LOADING&&t!==d.VIEW_STATUS_HIDDEN||(e.attr(o.config.viewStatusAttributeName,d.VIEW_STATUS_SHOW),e.css("display","block"),s.isNotEmptyString(r)&&(t=d.getViewScope(r,!1),s.isNullOrUndefined(t)||(e=t.onViewShow,s.isNullOrUndefined(e))||e()))},d.hiddenView=function(e){if(s.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');var e=jQuery(e),r=e.attr(o.config.viewIndexAttributeName),t=e.attr(o.config.viewStatusAttributeName);t!==d.VIEW_STATUS_SHOW&&t!==d.VIEW_STATUS_LOADING||(s.isNotEmptyString(r)&&(r=d.getViewScope(r,!1),t===d.VIEW_STATUS_LOADING||s.isNullOrUndefined(r)||(t=r.onViewHidden,s.isNullOrUndefined(t))||t()),e.attr(o.config.viewStatusAttributeName,d.VIEW_STATUS_HIDDEN),e.css("display","none"))},c.prototype.showMask=function(){jQuery(this._viewElement).prepend('<div class="pure-view-mask"><div></div></div>')},c.prototype.hiddenMask=function(){jQuery(this._viewElement).find(".pure-view-mask").remove()},w.prototype.thenResult=function(e,r){return this.doHandleResult(e,r,!1)},w.prototype.waitResult=function(e,r){return this.doHandleResult(e,r,!0)},w.prototype.doHandleResult=function(e,r,t){if(!s.isFunction(e))throw new Error('argument#1 "doneFn" required function');s.isNullOrUndefined(r)&&(r=function(e,r,t){w.handleAjaxError(this._sourceElement,e,r,t)});var n,i=this._deferred;return t&&!s.isNullOrUndefined(this._sourceElement)&&((n=new c(this._sourceElement)).showMask(),i.always(function(){n.hiddenMask()})),!1===jQuery.ajaxSettings.async?(200===i.status?e(i.responseJSON||responseText,"success",i):"timeout"===i.statusText?r(i,"timeout","timeout"):r(i,"error",""),i):i.then(e,r)},w.handleAjaxError=function(e,r,t,n){if(s.isNullOrUndefined(r))throw new Error('argument#0 "jqXHR" is null/undefined');var i;s.isNullOrUndefined(r.responseJSON)||(i=r.responseJSON.message),h.showError(i||o.messages.unknownError)},g.prototype.callService=function(e,r,t){if(!s.isString(e))throw new Error('argument#0 "url" required string');r=s.emptyObjectIfNullOrUndefined(r),t=s.emptyObjectIfNullOrUndefined(t);e={url:e,type:"POST",cache:!1,contentType:"application/json",dataType:"json",data:JSON.stringify(r),beforeSend:this.beforeSend,error:function(e,r,t){}},r=s.concatObjects([e,t]);return new w(jQuery.ajax(r),this._sourceElement)},g.prototype.beforeSend=function(e,r){},m.callService=function(e,r,t){if(s.isString(e))return(new g).callService(e,r,t);throw new Error('argument#0 "url" required string')},p.showMessage=function(e){e=s.emptyStringIfNullOrUndefined(e);var e=s.formatString('<div class="alert alert-success pure-app-alert" role="alert">{0}</div>',[e]),r=jQuery(e).prependTo("body");r.delay(1e3).fadeOut("fast",function(){r.remove()})},p.showError=function(e){e=s.emptyStringIfNullOrUndefined(e);var e=s.formatString('<div class="alert alert-warning pure-app-alert" role="alert">{0}</div>',[e]),r=jQuery(e).prependTo("body");r.delay(2e3).fadeOut("fast",function(){r.remove()})},h.viewScope=function(e,r){if(!s.isString(e))throw new Error('argument#0 "viewName" required string');if(!s.isFunction(r))throw new Error('argument#1 "registerFn" required function');r(d.getViewScope(e))},h.viewMain=function(e,r){if(!s.isString(e))throw new Error('argument#0 "viewName" required string');if(!s.isFunction(r))throw new Error('argument#1 "mainFn" required function');d.getViewScope(e).main=r},h.showMessage=function(e){p.showError(e)},h.showError=function(e){p.showError(e)},h.loadView=function(e){d.loadView(e)},h.pushView=function(e){d.pushView(e)},h.popView=function(e){d.popView(e)},e[r]={utils:s,app:h,config:o.config,messages:o.messages,fn:{Global:o,Utils:s,SequenceGenerator:t,UrlParser:n,BrowserUrl:u,View:a,ViewInfo:i,ViewResponse:l,ViewLoader:f,ViewManager:d,ViewMask:c,AjaxResult:w,AjaxCallService:g,Ajax:m,AppAlertMessages:p,App:h}})}(window,"Pure");