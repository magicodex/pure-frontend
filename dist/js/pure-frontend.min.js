"use strict";!function(e,r){function u(){}function a(){}function n(e){this._value=0<arguments.length?e:1}function t(){}function l(){}function s(e,r){if(a.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');if(a.isNullOrUndefined(r))throw new Error('argument#1 "viewInfo is null/undefined');this._viewElement=e,this._viewInfo=r,this._uiNameAttributeName=u.config.uiNameAttributeName,this._dataModel=new uiData.Model(e);e=r.getFullUrl(),r=r.getUrlPattern();this._urlParams=t.parseAllParams(e,r)}function i(){this._viewName=null,this._fullUrl=null,this._urlPattern=null}function f(e,r){if(a.isNullOrUndefined(e))throw new Error('argument#0 "url" is null/undefined');if(a.isNullOrUndefined(r))throw new Error('argument#1 "jqXHR" is null/undefined');this._url=e,this._jqXHR=r}function d(){}function w(){}function o(e){if(a.isNullOrUndefined(e))throw new Error('argument#0 "viewElement is null/undefined');this._viewElement=e}function c(e,r){if(a.isNullOrUndefined(e))throw new Error('argument#0 "deferred" is null/undefined');this._deferred=e,this._targetElement=r}function g(e){this._targetElement=e}function p(){}function m(){}function h(){}null==e[r]&&(u.config={uiNameAttributeName:"data-pure-ui-name",mainViewClassName:"pure-view-main",singlePageBaseUrl:"/"},u.messages={unknownError:"UnKnown error",notFoundviewName:"Not found viewName from response header",notFoundFullUrl:"Not found fullUrl from response header",notFoundUrlPattern:"Not found urlPattern from response header"},a.isString=function(e){return"string"==typeof e},a.isNumber=function(e){return"number"==typeof e},a.isObject=function(e){return"object"==typeof e},a.isFunction=function(e){return"function"==typeof e},a.isNullOrUndefined=function(e){return null==e},a.isNotEmptyString=function(e){return a.isString(e)&&0<e.length},a.isNotEmptyObject=function(e){if(!a.isNullOrUndefined(e)&&a.isObject(e))for(var r in e)return!0;return!1},a.emptyStringIfNullOrUndefined=function(e){return a.isNullOrUndefined(e)?"":e},a.emptyArrayIfNullOrUndefined=function(e){return a.isNullOrUndefined(e)?[]:e},a.emptyObjectIfNullOrUndefined=function(e){return a.isNullOrUndefined(e)?{}:e},a.convertToString=function(e){return"string"==typeof e||a.isNullOrUndefined(e)?e:String(e)},a.formatString=function(e,n){if(a.isNullOrUndefined(e))throw new Error('argument#0 "format" is null/undefined');if(!a.isString(e))throw new Error('argument#0 "format" required string');if(!(n instanceof Array)){n=[];for(var r=1;r<arguments.length;r++)n.push(arguments[r])}return e.replace(/\{([0-9]+)\}/g,function(e,r){r=parseInt(r),r=n[r];return a.convertToString(r)||""})},a.concatObjects=function(e){e instanceof Array||(e=arguments);for(var r={},n=0;n<e.length;n++){var t,i=e[n];for(t in i)r[t]=i[t]}return r},n.prototype.nextValue=function(){var e=this._value;return this._value++,e},t.parseAllParams=function(e,r){if(a.isNullOrUndefined(e))throw new Error('argument#0 "fullUrl" is null/undefined');if(a.isNullOrUndefined(r))throw new Error('argument#1 "urlPattern" is null/undefined');r=t.parsePathParams(e,r),e=t.parseQueryParams(e);return a.concatObjects(r,e)},t.parsePathParams=function(e,r){if(a.isNullOrUndefined(e))throw new Error('argument#0 "fullUrl" is null/undefined');if(a.isNullOrUndefined(r))throw new Error('argument#1 "urlPattern" is null/undefined');var n=e.indexOf("?");if(0===n)return{};for(var t={},i=(0<n?pageUrl.substring(0,n):e).split("/"),o=r.split("/"),u=0;u<o.length;u++){var l,s=o[u];s.startsWith("{")&&s.endsWith("}")&&(l=s.length-1,s=(s=s.substring(1,l)).trim(),l=globalUtils.emptyStringIfNullOrUndefined(i[u]),t[s]=l)}return t},t.parseQueryParams=function(e){if(a.isNullOrUndefined(e))throw new Error('argument#0 "fullUrl" is null/undefined');var r=e.indexOf("?");if(r<0||r+1===pageUrl.length)return{};for(var n={},t=e.substring(r+1).split("&"),i=0;i<t.length;i++){var o=t[i].split("="),u=(u=o[0]).trim(),o=(o=globalUtils.emptyStringIfNullOrUndefined(o[1])).trim();n[u]=decodeURIComponent(o)}return n},l.getBrowserUrl=function(e){if(a.isString(e))return e=e.startsWith("/")?"#"+e:"#/"+e,l.getFullUrl(u.config.singlePageBaseUrl)+e;throw new Error('argument#0 "viewUrl" required string')},l.setBrowserUrl=function(e){if(!a.isString(e))throw new Error('argument#0 "viewUrl" required string');e=l.getBrowserUrl(e);l.setLocationUrl(e)},l.getFullUrl=function(e){var r;if(a.isString(e))return r=jQuery("base").attr("href"),a.isNullOrUndefined(r)?r="/":r.endsWith("/")||(r+="/"),r+(e=e.startsWith("/")?e.substring(1):e);throw new Error('argument#0 "relativeUrl" required string')},l.setLocationUrl=function(e){if(!a.isString(e))throw new Error('argument#0 "newUrl" required string');location.href=e},s.prototype.getViewElement=function(){return this._viewElement},s.prototype.getViewInfo=function(){return this._viewInfo},s.prototype.getDataModel=function(){return this._dataModel},s.prototype.getUrlParams=function(){return this._urlParams},s.prototype.getUrlParam=function(e){return this._urlParams[e]},s.prototype.callService=function(e,r,n){return new g(this._viewElement).callService(e,r,n)},s.prototype.$find=function(){var e=jQuery(this._viewElement);return e.find.apply(e,arguments)},s.prototype.$ui=function(e){if(a.isNullOrUndefined(e))throw new Error('argument#0 "name" is null/undefined');var r=jQuery(this._viewElement),e=a.formatString("[{0}={1}]",[this._uiNameAttributeName,e]);return r.find(e)},i.prototype.getViewName=function(){return this._viewName},i.prototype.setViewName=function(e){this._viewName=e},i.prototype.getFullUrl=function(){return this._fullUrl},i.prototype.setFullUrl=function(e){this._fullUrl=e},i.prototype.getUrlPattern=function(){return this._urlPattern},i.prototype.setUrlPattern=function(e){this._urlPattern=e},f.viewNameHeaderName="x-page-code",f.fullUrlHeaderName="x-page-url",f.urlPatternHeaderName="x-url-pattern",f.prototype.getViewInfo=function(){var e=this._jqXHR.getResponseHeader(f.viewNameHeaderName);if(a.isNullOrUndefined(e))throw new Error(u.messages.notFoundviewName);var r=this._jqXHR.getResponseHeader(f.fullUrlHeaderName);if(a.isNullOrUndefined(r))throw new Error(u.messages.notFoundFullUrl);var n=this._jqXHR.getResponseHeader(f.urlPatternHeaderName);if(a.isNullOrUndefined(n))throw new Error(u.messages.notFoundUrlPattern);var t=new i;return t.setViewName(e),t.setFullUrl(r),t.setUrlPattern(n),t},d.sequenceGenerator=new n(100001),d.lastView={},d.loadView=function(t){if(!a.isString(t))throw new Error('argument#0 "url" required string');jQuery.ajax({url:t,type:"POST"}).done(function(e,r,n){d.preRenderView(t,e,r,n)&&d.renderView(t,e,r,n)})},d.preRenderView=function(e,r,n,t){return!0},d.renderView=function(e,r,n,t){if(!a.isString(e))throw new Error('argument#0 "url" required string');var t=new f(e,t).getViewInfo(),i=t.getViewName(),o="."+u.config.mainViewClassName,o=jQuery(o),r=(o.attr("id",i),o.html(r),d.initViewAfterRender(o),l.setBrowserUrl(e),new s(o[0],t)),e=w.getViewScope(i);d.lastView.viewScope=a.emptyObjectIfNullOrUndefined(e),d.lastView.appView=r,null!=e&&null!=(o=e.main)&&o(e,r)},d.initViewAfterRender=function(i){if(a.isNullOrUndefined(i))throw new Error('argument#0 "jqView" is null/undefined');i.find("label[for]").each(function(e,r){var n,t=r.getAttribute("for");a.isNotEmptyString(t)&&(n=t+"_"+d.sequenceGenerator.nextValue(),i.find("#"+t).attr("id",n),r.setAttribute("for",n))})},w.viewScopes={},w.getViewScope=function(e){var r;if(a.isString(e))return r=w.viewScopes[e],a.isNullOrUndefined(r)&&(w.viewScopes[e]=r={}),r;throw new Error('argument#0 "viewName" required string')},w.loadView=function(e){if(!a.isString(e))throw new Error('argument#0 "url" required string');d.loadView(e)},w.pushView=function(e){if(!a.isString(e))throw new Error('argument#0 "url" required string');d.loadView(e)},w.popView=function(e){if(!a.isString(e))throw new Error('argument#0 "url" required string');d.loadView(e)},o.prototype.showMask=function(){jQuery(this._viewElement).prepend('<div class="pure-view-mask"><div></div></div>')},o.prototype.hiddenMask=function(){jQuery(this._viewElement).find(".pure-view-mask").remove()},c.prototype.thenResult=function(e,r){return this.doHandleDeferred(this._deferred,e,r,!1)},c.prototype.waitResult=function(e,r){return this.doHandleDeferred(this._deferred,e,r,!0)},c.prototype.doHandleDeferred=function(e,r,n,t){if(a.isNullOrUndefined(e))throw new Error('argument#0 "deferred" is null/undefined');var i;if(a.isFunction(r))return a.isNullOrUndefined(n)&&(n=function(e,r,n){this.handleAjaxError(e,r,n)}),t&&!a.isNullOrUndefined(this._targetElement)&&((i=new o(this._targetElement)).showMask(),e.always(function(){i.hiddenMask()})),!1===jQuery.ajaxSettings.async?(200===e.status?r(e.responseJSON||responseText,"success",e):"timeout"===e.statusText?n(e,"timeout","timeout"):n(e,"error",""),e):e.then(r,n);throw new Error('argument#1 "doneFn" required function')},c.prototype.handleAjaxError=function(e,r,n){if(a.isNullOrUndefined(e))throw new Error('argument#0 "jqXHR" is null/undefined');var t;a.isNullOrUndefined(e.responseJSON)||(t=e.responseJSON.message),h.showError(t||u.message.unknownError)},g.prototype.callService=function(e,r,n){if(!a.isString(e))throw new Error('argument#0 "url" required string');r=a.emptyObjectIfNullOrUndefined(r),n=a.emptyObjectIfNullOrUndefined(n);e={url:e,type:"POST",cache:!1,contentType:"application/json",dataType:"json",data:JSON.stringify(r),beforeSend:this.beforeSend,error:function(e,r,n){}},r=a.concatObjects([e,n]);return new c(jQuery.ajax(r),this._targetElement)},g.prototype.beforeSend=function(e,r){},p.callService=function(e,r,n){if(a.isString(e))return(new g).callService(e,r,n);throw new Error('argument#0 "url" required string')},m.showMessage=function(e){e=a.emptyStringIfNullOrUndefined(e);var e=a.formatString('<div class="alert alert-success pure-app-alert" role="alert">{0}</div>',[e]),r=jQuery(e).prependTo("body");r.delay(1e3).fadeOut("fast",function(){r.remove()})},m.showError=function(e){e=a.emptyStringIfNullOrUndefined(e);var e=a.formatString('<div class="alert alert-warning pure-app-alert" role="alert">{0}</div>',[e]),r=jQuery(e).prependTo("body");r.delay(2e3).fadeOut("fast",function(){r.remove()})},h.viewScope=function(e,r){if(!a.isString(e))throw new Error('argument#0 "viewName" required string');if(!a.isFunction(r))throw new Error('argument#1 "callbackFn" required function');r(w.getViewScope(e))},h.viewMain=function(e,r){if(!a.isString(e))throw new Error('argument#0 "viewName" required string');if(!a.isFunction(r))throw new Error('argument#1 "mainFn" required function');w.getViewScope(e).main=r},h.showMessage=function(e){m.showError(e)},h.showError=function(e){m.showError(e)},h.loadView=function(e){w.loadView(e)},h.pushView=function(e){w.pushView(e)},h.popView=function(e){w.popView(e)},e[r]={utils:a,app:h,config:u.config,messages:u.messages,fn:{Global:u,Utils:a,SequenceGenerator:n,UrlParser:t,BrowserUrl:l,View:s,ViewInfo:i,ViewResponse:f,ViewLoader:d,ViewManager:w,ViewMask:o,AjaxResult:c,AjaxCallService:g,Ajax:p,AppAlertMessages:m,App:h}})}(window,"Pure");